package com.dodgems.pages.home{	import com.gaiaframework.templates.AbstractPage;	import com.gaiaframework.events.*;	import com.gaiaframework.debug.*;	import com.gaiaframework.api.*;		import flash.display.*;	import flash.text.*;	import flash.events.*;	import flash.geom.Rectangle;	import flash.net.URLRequest;	import flash.net.URLLoader;	import flash.net.navigateToURL;	import com.greensock.TweenMax;	import com.greensock.easing.*;		import flash.geom.Point;	import flash.geom.Rectangle;		import com.dodgems.pages.HomePage;			public class TertiaryPromo extends Sprite	{		public var bgclip:MovieClip;				private var dataXML:XMLList;		private var navArr:Array = new Array();		private var totalPromos:Number;		private var currentLoadNum:int;		private var promoLoader:Loader;		private var navContainer:Sprite;						public function TertiaryPromo(dat:XMLList) {			dataXML = dat;						promoLoader = new Loader();			promoLoader.contentLoaderInfo.addEventListener(Event.COMPLETE, finishLoading, false, 0, true);						addEventListener(Event.ADDED_TO_STAGE, onAdded, false, 0, true);			addEventListener(Event.REMOVED_FROM_STAGE, onRemoved, false, 0, true);		}						private function animBG():void {			navContainer = new Sprite();			addChild(navContainer);			TweenMax.from(bgclip, 0.5, { y: -bgclip.height, ease:Bounce.easeOut, onComplete: beginLoad } );			bgclip.alpha = 1;		}				private function beginLoad():void {			TweenMax.delayedCall(1.5, loadNav);		}						private function loadNav():void {			if(currentLoadNum < totalPromos){				promoLoader.load(new URLRequest(dataXML.promo[currentLoadNum].@asset));			}		}						private function finishLoading(e:Event):void {						var mc:MovieClip = new MovieClip();			mc.name = "nav" + currentLoadNum;			mc.x = navContainer.width;			mc.addChild(e.currentTarget.content);			navContainer.addChild(mc);						var arr:Array = [e.currentTarget.content, dataXML.promo[currentLoadNum].@url];			navArr.push(arr);						var but:MovieClip = navArr[currentLoadNum][0].hit;			but.addEventListener(MouseEvent.CLICK, navClick, false, 0, true);			but.addEventListener(MouseEvent.MOUSE_OVER, navOver, false, 0, true);			but.addEventListener(MouseEvent.MOUSE_OUT, navOut, false, 0, true);			but.buttonMode = true;						currentLoadNum++;						loadNav();		}						private function navClick(e:MouseEvent):void {			navContainer.addChild(e.currentTarget.parent.parent);			var num:Number = Number(e.currentTarget.parent.parent.name.substring(3))			var keyword:String = navArr[num][1];						if(keyword.substr(0, 4) == "http"){				navigateToURL(new URLRequest(keyword), "_blank");			} else if(keyword != "comingsoon") {				Gaia.api.getPage("index/nav").content.siteNavCall(keyword);			}		}						private function navOver(e:MouseEvent):void {			var mc:MovieClip = e.currentTarget.parent;			mc.parent.addChild(mc);			mc.gotoAndStop("over");		}						private function navOut(e:MouseEvent):void {			var mc:MovieClip = e.currentTarget.parent;			mc.gotoAndStop("wait");		}						public function onAdded(e:Event):void {			bgclip.alpha = 0;			animBG();			totalPromos = dataXML.elements().length();		}				private function onRemoved(e:Event):void {			removeEventListener(Event.REMOVED_FROM_STAGE, onRemoved);		}					}}