package com.dodgems.pages{	import com.barliesque.DataTree;	import com.gaiaframework.assets.MovieClipAsset;	import com.gaiaframework.templates.AbstractPage;	import com.gaiaframework.events.*;	import com.gaiaframework.debug.*;	import com.gaiaframework.api.*;		import flash.display.*;	import flash.events.*;	import flash.geom.Rectangle;	import flash.media.Sound;	import flash.media.SoundChannel;		import com.greensock.TweenMax;	import com.greensock.easing.*;		import com.dodgems.pages.home.*;	import com.dodgems.Global;		public class HomePage extends AbstractPage {				public var primary:PrimaryPromo;		public var secondary:SecondaryPromo;		public var tertiary:TertiaryPromo;				public var topClip:TopBar;		public var BG_WIDTH:Number = 957;				private var dataXML:XML;				public var navPlaceholder:MovieClip;				private var navPage:MovieClip;				//---------------------------------------------				public function HomePage() {			super();			addEventListener(Event.ADDED_TO_STAGE, onAdded, false, 0, true);						navPlaceholder = new MovieClip();			navPlaceholder.x = 160;			navPlaceholder.graphics.beginFill(0x000000, 30);			navPlaceholder.graphics.drawRect(0, 0, 200, 490);			navPlaceholder.graphics.endFill();						if (Gaia.api) navPage = Gaia.api.getPage("index/nav").content;		}				private function createBG():void {			var bg:Sprite = new Sprite();			bg.graphics.beginFill(0x000000, .3);			bg.graphics.drawRect(0, 0, BG_WIDTH, stage.stageHeight);			bg.graphics.endFill();			addChild(bg);						bg.scaleX = 0.1;						bg.x = (Gaia.api.getWidth() / 2) - ((bg.width * 0.1) / 2);			bg.y = -bg.height;						var t:Number = 0.3;			var xpos:Number = (Gaia.api.getWidth() / 2) - (BG_WIDTH / 2);						if (Global.homepageVisited){				Global.homepageVisited = true;				TweenMax.to(bg, t, { y:0, ease:Strong.easeIn, onComplete:createPromos } );				TweenMax.to(bg, 2, { scaleX:1, x:xpos, ease:Strong.easeOut, delay:t } );			} else {				bg.y = 0;				bg.scaleX = 1;				bg.x = xpos;				createPromos();			}		}						private function onAdded(e:Event):void {						var sndExplodeChannel:SoundChannel;			var sndExplode:sfxCrowd;			sndExplode = new sfxCrowd();						removeEventListener(Event.ADDED_TO_STAGE, onAdded);			addEventListener(Event.REMOVED_FROM_STAGE, onRemoved, false, 0, true);		}						private function onRemoved(e:Event):void {			topClip.parent.removeChild(topClip);			addEventListener(Event.ADDED_TO_STAGE, onAdded);		}						private function createPromos():void {						//top			primary = new PrimaryPromo(dataXML.primary);			primary.x = (Gaia.api.getWidth()/2) - (primary.bg.width/2);						//middle			secondary = new SecondaryPromo(dataXML.secondary);			secondary.x = primary.x;			secondary.y = primary.bg.height + 10;						//bottom			tertiary = new TertiaryPromo(dataXML.third);			tertiary.x = primary.x;			tertiary.y = secondary.y + 220;						//topclip			var tearEnabled:Boolean = false;			if (dataXML.tear) if (dataXML.tear.@enabled == "true") tearEnabled = true;			topClip = new TopBar();			topClip.x = -200;			addChild(topClip);			topClip.popData(dataXML.topbar, tearEnabled);			navPage.addChild(topClip);			navPage.resortZ(topClip);			topClip.visible = true;			topClip.mouseEnabled = topClip.mouseChildren = true;									addChild(tertiary);			addChild(primary);			addChild(secondary);		}				private var dataTree:DataTree;		override public function transitionIn():void {						super.transitionIn();						dataTree = new DataTree(assets.homeXML.xml, contTransIn);		}						private function contTransIn(dataXML:XML):void {			this.dataXML = dataXML;			createBG();			addChildAt(navPlaceholder, getChildIndex(secondary));						navPage["showNav"](true);			navPage["positionNav"]();						transitionInComplete();		}						override public function transitionOut():void {			super.transitionOut();						navPage["showNav"](false);						transitionOutComplete();			//TweenMax.to(this, 0.3, {alpha:0, onComplete:transitionOutComplete});		}	}}